import{d as O,m as Q,s as W,o as X,r as k,w as Y,g,a as m,c as b,b as t,j as C,B as V,i as p,F as y,t as I,x as ee,J as te,p as $,Z as se,k as P,h as x,q as oe,l as ae,N as le,u as ie,D as ne,v as re,S as ue,G as de}from"./index-50a2709c.js";import{d as S}from"./vuedraggable.umd-6766086f.js";import{_ as ce}from"./CommonModal.vue_vue_type_script_setup_true_lang-a9fddaa2.js";import{u as me}from"./instructor-c8d2850c.js";const pe={class:"mb-4 flex items-center justify-between rounded bg-neutral-50 p-4"},he=t("h1",{class:"font-bold text-neutral-800"},"章節管理",-1),_e={class:"rounded bg-neutral-50 p-6"},fe={class:"relative mb-8 rounded border bg-neutral-50"},ve={class:"group flex h-14 items-center pe-12 ps-4"},be=t("i",{class:"material-icons js-draggable me-2 cursor-row-resize"},"sort",-1),Ce={class:"me-4"},ke=["onClick"],ge=["onClick"],ye=["onKeyup"],xe=["disabled","onClick"],we=["onClick"],Ve=["onClick"],Ie=t("input",{checked:"",type:"checkbox",class:"peer absolute right-4 top-4 z-10 h-6 w-6 cursor-pointer opacity-0"},null,-1),$e=t("span",{class:"material-icons absolute right-4 top-4 rotate-0 transition-transform transition-transform duration-300 peer-checked:rotate-180"},"keyboard_arrow_down",-1),Ee={class:"border"},Te=t("i",{class:"material-icons js-draggable me-2 cursor-row-resize"},"sort",-1),Fe={class:"me-3"},Pe=t("i",{class:"material-icons me-4 ms-auto cursor-pointer text-neutral-800"},"visibility",-1),Se=["onClick"],je={key:1},Be={class:"mb-6"},Le=["disabled"],Ue=O({__name:"CourseChapterView",setup(Me){const j=ie(),d=ne(),{updateLoading:n}=Q(),{showError:h}=re(),E=me(),{getCourseChapters:B,addCourseChapter:L,deleteCourseChapter:M,editCourseChapterTitle:N,publishCourseLesson:z,unPublishCourseLesson:D}=E,{chapters:a,course:Ne}=W(E);X(()=>{K()});function K(){n(!0),B({courseId:+d.params.courseId}).catch(e=>{h(e)}).finally(()=>{n(!1)})}function R(e){ue.fire({icon:"warning",title:"確定刪除嗎？",showCancelButton:!0}).then(s=>{s.isConfirmed&&(n(!0),M({courseId:+d.params.courseId,chapterId:e}).then(()=>{}).catch(i=>{h(i)}).finally(()=>{n(!1)}))})}const r=k("");function U(e){a.value=a.value.map(s=>({...s,isEdit:!1})),r.value=a.value[e].title,a.value[e].isEdit=!0}function T(e){n(!0),N({courseId:+d.params.courseId,chapterId:a.value[e].id,chapterTitle:r.value}).then(()=>{a.value[e].title=r.value,a.value[e].isEdit=!1,r.value=""}).catch(s=>{h(s)}).finally(()=>{n(!1)})}function q(e){a.value[e].isEdit=!1,r.value=""}const _=k(!1),F=k(null),f=k("");Y(_,()=>{f.value="",de(()=>{var e;(e=F.value)==null||e.resetForm()})});function A(){n(!1),L({courseId:+d.params.courseId,chapterTitle:f.value}).then(()=>{f.value="",_.value=!1}).catch(e=>{h(e)}).finally(()=>{n(!1)})}function G(e){j.push(`/instructor/course/${+d.params.courseId}/chapter/${e}/lesson`)}function H(e,s){n(!0),z({courseId:+d.params.courseId,chapterId:e,lessonId:s}).then(()=>{const i=a.value.findIndex(u=>u.id===e),v=a.value[i].lessons.findIndex(u=>u.id===s);a.value[i].lessons[v].isPublish=!0}).catch(i=>{h(i)}).finally(()=>{n(!1)})}function J(e,s){n(!0),D({courseId:+d.params.courseId,chapterId:e,lessonId:s}).then(()=>{const i=a.value.findIndex(u=>u.id===e),v=a.value[i].lessons.findIndex(u=>u.id===s);a.value[i].lessons[v].isPublish=!1}).catch(i=>{h(i)}).finally(()=>{n(!1)})}return(e,s)=>{const i=g("router-link"),v=g("ErrorMessage"),u=g("VField"),Z=g("VForm");return m(),b(y,null,[t("div",pe,[he,t("button",{class:"btn-primary",onClick:s[0]||(s[0]=l=>_.value=!0)},"新增章節")]),t("div",_e,[C(a).length!==0?(m(),V(C(S),{key:0,class:"dragArea",list:C(a),"item-key":"id",handle:".js-draggable",group:{name:"g1"}},{item:p(({element:l,index:c})=>[t("div",fe,[t("div",ve,[be,l.isEdit?(m(),b(y,{key:1},[ee(t("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>r.value=o),id:"url",class:$(["form-control me-4 max-w-sm",{invalid:!r.value}]),onKeyup:se(o=>!!r.value&&T(c),["enter"])},null,42,ye),[[te,r.value,void 0,{trim:!0}]]),t("button",{class:"me-4",disabled:r.value==="",onClick:o=>T(c)}," 確定 ",8,xe),t("button",{onClick:o=>q(c)},"取消",8,we)],64)):(m(),b(y,{key:0},[t("span",Ce,I(l.title),1),t("i",{class:"material-icons me-4 hidden cursor-pointer text-red-400 group-hover:block",onClick:o=>R(l.id)},"delete_outline",8,ke),t("i",{class:"material-icons hidden cursor-pointer text-neutral-400 group-hover:block",onClick:o=>U(c)},"edit",8,ge)],64)),t("button",{class:"btn-secondary ms-auto",onClick:o=>G(l.id)},"新增單元",8,Ve)]),l.lessons.length!==0?(m(),b(y,{key:0},[Ie,$e],64)):P("",!0),(m(),V(C(S),{key:l.id,class:"max-h-0 overflow-hidden bg-neutral-100 transition-all duration-300 peer-checked:max-h-full",tag:"ul",group:{name:"g2"},list:l.lessons,"item-key":"id",handle:".js-draggable"},{item:p(({element:o})=>[t("li",Ee,[x(i,{to:`/instructor/course/${+C(d).params.courseId}/chapter/${l.id}/lesson/${o.id}`,class:"flex cursor-pointer items-center p-4"},{default:p(()=>[Te,t("span",Fe,I(o.title),1),t("span",{class:$([[o.isPublish?"text-emerald-700":"text-neutral-600"],"rounded-full border bg-neutral-50 px-4 py-1 text-sm"])},I(o.isPublish?"已發布":"未發布"),3),Pe,t("i",{class:$([[o.isPublish?"text-emerald-700":"text-neutral-600"],"material-icons cursor-pointer"]),onClick:oe(w=>o.isPublish?J(l.id,o.id):H(l.id,o.id),["prevent"])},"check_circle_outline",10,Se)]),_:2},1032,["to"])])]),_:2},1032,["list"]))])]),_:1},8,["list"])):(m(),b("div",je,"尚無章節"))]),x(ce,{modelValue:_.value,"onUpdate:modelValue":s[3]||(s[3]=l=>_.value=l)},{title:p(()=>[ae("新增章節")]),default:p(()=>[x(Z,{ref_key:"addChapterForm",ref:F,onSubmit:A},{default:p(({meta:l})=>[t("div",Be,[x(u,{name:"chapter",type:"text",rules:"required",modelValue:f.value,"onUpdate:modelValue":s[2]||(s[2]=c=>f.value=c),label:"章節"},{default:p(({field:c,errors:o,meta:w})=>[t("input",le({id:"chapter",class:"form-control",placeholder:"輸入章節標題"},c,{class:{invalid:w.validated&&!!o.length}}),null,16),w.validated?(m(),V(v,{key:0,class:"invalid-feedback",name:"chapter"})):P("",!0)]),_:2},1032,["modelValue"])]),t("button",{type:"submit",class:"btn-primary mx-auto block w-fit",disabled:!l.valid}," 新增 ",8,Le)]),_:1},512)]),_:1},8,["modelValue"])],64)}}});export{Ue as default};
