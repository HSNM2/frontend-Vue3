import{d as te,m as ae,s as oe,r as l,o as le,G as re,g as L,a as n,c as d,b as s,t as S,j as h,h as _,i as I,N as E,B as N,k as g,p as x,q as c,F as q,l as ne,D as ie,u as ue,v as de,S as C,R as ce}from"./index-bcaa0858.js";import{u as me}from"./instructor-f129cc3c.js";const pe={class:"mb-4 rounded bg-neutral-50 p-4"},ve={class:"font-bold text-neutral-800"},fe={class:"rounded bg-neutral-50 p-6"},he={class:"mb-6"},_e=s("label",{for:"lesson",class:"form-label"},"單元名稱",-1),be={class:"mb-6"},ye=s("label",{for:"",class:"form-label"},"單元內容",-1),ke={class:"rounded border"},Ie={class:"flex border-b px-6 pt-2"},ge={class:"p-6"},xe={key:0},Ce={key:0},we={class:"h-96 w-full"},Ve={key:0,class:"flex items-center"},Fe=s("i",{class:"material-icons me-1"},"delete_forever",-1),Te={for:"lessonFile"},De=["onDrop"],Le=s("span",{class:"flex h-full flex-col items-center justify-center"},[s("i",{class:"material-icons text-4xl"},"file_upload"),s("span",{class:"mb-2 block text-2xl"},"將檔案拖曳至此或點擊此處選擇檔案"),s("span",{class:"block text-neutral-600"}," 檔案格式限定為 mp4、avi、mov、wmv、flv、mkv、webm ")],-1),Se=[Le],Be=["onBlur"],Me={key:1},$e={class:"mb-6 border-b pb-6"},Ue=s("label",{for:"url",class:"form-label"},"網址",-1),Pe=s("span",{class:"text-xs text-neutral-400"},"支援Vimeo以及Youtube連結",-1),Re=s("button",{class:"ms-auto block w-fit",disabled:""},"新增",-1),Ee={class:"flex items-center"},Ne=["disabled"],qe=["onClick"],Ae=te({__name:"CourseLessonView",setup(je){const a=ie(),b=ue(),{showError:w}=de(),{updateLoading:r}=ae(),B=me(),{getCourseChapter:j,getCourseLesson:H,addCourseLesson:z,editCourseLesson:A,deleteCourseLesson:G}=B,{chapter:M,lesson:m}=oe(B),V=l(null),y=l(!1),p=l(""),F=l(""),v=l("file"),u=l(null),$=l(""),i=l(),k=l(10),T=l();function K(t){T.value=t.state,i.value=t.player}function Y(t){var e;if(i.value)switch(t.which){case 32:t.preventDefault(),(e=T.value)!=null&&e.playing?i.value.pause():i.value.play();break;case 39:i.value.currentTime(i.value.currentTime()+k.value);break;case 37:i.value.currentTime(i.value.currentTime()-k.value);break}}le(()=>{r(!0),m.value=null,j({courseId:+a.params.courseId,chapterId:+a.params.chapterId}).then(()=>{if(a.params.lessonId)return U()}).catch(t=>{w(t).then(()=>{b.push(`/instructor/course/${a.params.courseId}`)})}).finally(()=>{r(!1)})});function J(){b.push(`/instructor/course/${a.params.courseId}`)}function U(){return H({courseId:+a.params.courseId,chapterId:+a.params.chapterId,lessonId:+a.params.lessonId}).then(()=>{m.value&&(p.value=m.value.title,F.value=m.value.videoPath,re(()=>{var t,e;(t=V.value)==null||t.resetForm({values:{lessonTitle:p.value}}),(e=V.value)==null||e.validateField("lessonTitle")}))})}function O(){C.fire({icon:"warning",title:"確定刪除嗎？",showCancelButton:!0}).then(t=>{t.isConfirmed&&(r(!0),G({courseId:+a.params.courseId,chapterId:+a.params.chapterId,lessonId:+a.params.lessonId}).then(e=>(r(!1),C.fire({icon:"success",title:e.data.data.message}))).then(()=>{b.push(`/instructor/course/${a.params.courseId}`)}).finally(()=>{r(!1)}))})}function Q(t){y.value=!1,t.dataTransfer&&t.dataTransfer.files[0]&&(u.value=t.dataTransfer.files[0])}function W(t){const e=t.target.files;e&&e.length!==0&&(u.value=e[0])}function X(){u.value=null}function Z(){r(!0);const t=new FormData;t.append("title",p.value),u.value&&t.append("video",u.value),a.params.lessonId?A({courseId:+a.params.courseId,chapterId:+a.params.chapterId,lessonId:+a.params.lessonId,data:{title:p.value}}).then(e=>(C.fire({icon:"success",title:e.data.data.message}),U())).catch(e=>{w(e)}).finally(()=>{r(!1)}):z({courseId:+a.params.courseId,chapterId:+a.params.chapterId,data:t}).then(e=>(r(!1),C.fire({icon:"success",title:e.data.data.message}))).then(()=>{b.push(`/instructor/course/${a.params.courseId}`)}).catch(e=>{w(e)}).finally(()=>{r(!1)})}return(t,e)=>{const P=L("ErrorMessage"),D=L("VField"),ee=L("VForm");return n(),d(q,null,[s("div",pe,[s("h1",ve,S(h(M)&&h(M).title),1)]),s("div",fe,[_(ee,{ref_key:"lessonForm",ref:V,onSubmit:Z},{default:I(({meta:se})=>[s("div",he,[_e,_(D,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=o=>p.value=o),modelModifiers:{trim:!0},name:"lessonTitle",rules:"required",label:"單元名稱"},{default:I(({field:o,errors:f,meta:R})=>[s("input",E({type:"text",id:"lesson",class:"form-control"},o,{class:{invalid:R.validated&&!!f.length}}),null,16),R.validated?(n(),N(P,{key:0,class:"invalid-feedback",name:"lessonTitle"})):g("",!0)]),_:2},1032,["modelValue"])]),s("div",be,[ye,s("div",ke,[s("nav",Ie,[s("a",{href:"#",class:x(["px-4 py-2",{"border-b-2 border-primary-4":v.value==="file"}]),onClick:e[1]||(e[1]=c(o=>v.value="file",["prevent"]))},"上傳檔案",2),s("a",{href:"#",class:x(["px-4 py-2",{"border-b-2 border-primary-4":v.value==="mediaUrl"}]),onClick:e[2]||(e[2]=c(o=>v.value="mediaUrl",["prevent"]))},"嵌入影片網址",2)]),s("div",ge,[v.value==="file"?(n(),d("div",xe,[F.value?(n(),d("div",Ce,[s("div",we,[_(h(ce),{src:F.value,controls:"",class:x(["h-full w-full",{loading:!T.value}]),playbackRates:[.5,1,1.5,2],preload:"auto",onMounted:K,"control-bar":{skipButtons:{forward:k.value,backward:k.value}},"user-actions":{hotkeys:Y}},null,8,["src","class","playbackRates","control-bar","user-actions"])])])):(n(),d(q,{key:1},[u.value?(n(),d("div",Ve,[s("span",null,S(u.value.name),1),s("span",{class:"ms-auto flex cursor-pointer items-center text-red-400",onClick:X},[Fe,ne("移除")])])):(n(),N(D,{key:1,rules:"required|ext:mp4,mov",name:"file"},{default:I(({handleBlur:o})=>[s("label",Te,[s("span",{class:x(["block h-96 rounded border border-dashed hover:border-primary-4",[y.value?"border-primary-4":""]]),onDragover:e[3]||(e[3]=c(f=>y.value=!0,["prevent"])),onDragleave:e[4]||(e[4]=c(f=>y.value=!1,["prevent"])),onDrop:c(Q,["prevent"])},Se,42,De),s("input",{id:"lessonFile",type:"file",class:"absolute hidden",onChange:W,onBlur:o,accept:".mp4,.avi,.mov,.wmv,.flv,.mkv,.webm"},null,40,Be)])]),_:1}))],64))])):g("",!0),v.value==="mediaUrl"?(n(),d("div",Me,[s("div",$e,[Ue,_(D,{name:"url",type:"text",rules:"required",modelValue:$.value,"onUpdate:modelValue":e[5]||(e[5]=o=>$.value=o),modelModifiers:{trim:!0},label:"網址"},{default:I(({field:o,errors:f})=>[s("input",E({id:"url",class:"form-control"},o,{placeholder:"https://vimeo.com/... 或是 https://youtube.com/...",class:{invalid:!!f.length}}),null,16),Pe]),_:1},8,["modelValue"]),_(P,{class:"invalid-feedback",name:"url"})]),Re])):g("",!0)])])]),s("div",Ee,[s("button",{class:"me-5",type:"submit",disabled:!se.valid},S(h(m)?"更新":"新增"),9,Ne),s("button",{class:"text-neutral-500",onClick:e[6]||(e[6]=c(o=>J(),["prevent"]))},"取消"),h(m)?(n(),d("button",{key:0,class:"ms-auto text-red-500",onClick:c(O,["prevent"])}," 刪除 ",8,qe)):g("",!0)])]),_:1},512)])],64)}}});export{Ae as default};
